<?xml version="1.0" encoding="UTF-8"?>
<!-- sql-test.xml : 마이바티스 실행을 위해 필요한 파일 -->

<!-- mybatis SQL 매핑 파일을 뜻하는 지시문 -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- namespace 속성에 지정한 패키지명을 가지고 있는 파일과 아래의 xml 구문을 연동한다는 의미 -->
<!-- ★★★ xml 파일이기 때문에 스프링 프로젝트의 전체 구조를 모르기 때문에 전체 패키지 명을 다 입력해야 함 ★★★ -->
<mapper namespace="com.gaya.thegayap.mapper.SinMapper">


    <!--    임시코드 시작-->
    <insert id="insertHotel" parameterType="com.gaya.thegayap.dto.SinDto">
        insert into hotel_table(hotel_name, hotel_addr, hotel_tel, hotel_meal_adult, hotel_meal_child)
        values (#{hotelName}, #{hotelAddr}, #{hotelTel}, #{hotelMealAdult}, #{hotelMealChild});
    </insert>

    <insert id="insertRoom" parameterType="com.gaya.thegayap.dto.SinDto2">


        insert into hotel_room_table(room_hotel_idx, room_name, room_twin_cost, room_twin_weekend, room_code,
                                     room_max_adult)
        values (#{roomHotelIdx}, #{roomName}, #{roomTwinCost}, #{roomTwinWeekend}, #{roomCode}, #{roomMaxAdult});


    </insert>

    <!--    임시코드 종료-->

    <!--    roomCode 중복확인-->
    <select id="checkCodeOverlap" parameterType="String" resultType="int">


        select count(*)
        from hotel_room_table
        where room_code = #{code};

    </select>


    <!--    호텔에 방 리스트-->
    <select id="getHotelRoomList" parameterType="com.gaya.thegayap.dto.SinFilterRoomDto" resultType="com.gaya.thegayap.dto.SinRoomDto">
        SELECT *
        FROM hotel_room_table
        where room_hotel_num = #{hotelNum}
          and room_max_adult >= #{adultCount}
    </select>


    <!--   스테이에 방 리스트 -->
    <select id="getStayRoomList" parameterType="int" resultType="com.gaya.thegayap.dto.SinRoomDto">
        SELECT *
        FROM stay_room_table
        where room_hotel_num = #{hotelNum}
    </select>

    <!--    예약 중복 확인-->
    <select id="checkBookOverlap"  resultType="com.gaya.thegayap.dto.SinRoomDto">
        select rt.reservation_room_code
        from reservation_table as rt
                 left join hotel_room_table as ht
                           on rt.reservation_room_code = ht.room_code
        where ht.room_hotel_num = 1
          and ht.room_max_adult >= 3
          and reservation_check_out > '2023-02-16'  and '2023-02-17' > reservation_check_in;
    </select>

    <!--    호텔 이름으로 호텔 번호 불러오기-->
    <select id="getHotelNum" parameterType="String" resultType="int">
        select hotel_num
        from hotel_table
        where hotel_name = #{hotelName};
    </select>

    <!--    예약 DB 입력-->
    <insert id="reservationRoom" parameterType="com.gaya.thegayap.dto.SinReservDto">
        insert into reservation_table
        values (#{reservationNum}, #{hotelNum}, #{roomCode}, #{customerName}, #{customerId}, #{checkIn}, #{checkOut},
                NOW(), #{nights}, #{breakfastAdultNum}, #{breakfastChildNum}, #{reservationPeople}, #{totalCost},
                #{reservationRequest})
    </insert>

    <!--    문의 게시글 -->
    <select id="getQAList" resultType="com.gaya.thegayap.dto.SinInquiryDto">
        select *
        from inquiry_table
        where inquiry_deleted_yn = 'N'
    </select>
    <!-- 전체 호텔 이름-->
    <select id="getHotelName" resultType="String">
        select hotel_name
        from hotel_table
        where 1 = 1
    </select>
    <!-- 문의 답글 불러오기 -->
    <select id="getAnswerList" parameterType="int" resultType="com.gaya.thegayap.dto.SinAnswerChatDto">
        select *
        from answer_table
        where answer_inquiry_num = #{idx}
    </select>
    <!-- 답글 DB 입력-->
    <insert id="insertReply" parameterType="com.gaya.thegayap.dto.SinAnswerChatDto">
        insert into answer_table(answer_inquiry_num, answer_contents, answer_create_date, answer_user_name,
                                 answer_is_admin)
        values (#{answerInquiryNum}, #{answerContents}, now(), #{answerUserName}, #{answerIsAdmin});
    </insert>

    <!-- 방의 가격과 조식 가격 불러오기-->
    <select id="getRoomAndMealCost" parameterType="String" resultType="com.gaya.thegayap.dto.SInRoomCostDto">

        <if test='roomCode.contains("stay")'>
            SELECT ht.hotel_meal_adult, ht.hotel_meal_child, srt.room_twin_cost, srt.room_twin_weekend,
            srt.room_family_cost, srt.room_family_weekend
            from stay_room_table as srt
            left join hotel_table as ht
            on srt.room_hotel_num = ht.hotel_num
            where srt.room_code = #{roomCode}
        </if>

        <if test='roomCode.contains("hotel")'>
            SELECT ht.hotel_meal_adult, ht.hotel_meal_child, hrt.room_twin_cost, hrt.room_twin_weekend
            from hotel_room_table as hrt
            left join hotel_table as ht
            on hrt.room_hotel_num = ht.hotel_num
            where hrt.room_code = #{roomCode}
        </if>

    </select>

</mapper>
